# -*- text -*-
##
## osp.conf -- Configuration for OSP running parameters
##
## $Id$

#
# Introduction
# ====================================================================
# The FreeRADIUS OSP module maps RADIUS accounting records to OSP
# UsageIndication elements.  The OSP module then uses OSP Toolkit to
# forward those UsageIndication elements as OSP call detail records
# (OSP CDRs) or OSP UsageIndication messages to an OSP server.
# Multiple OSP servers can be configured for redundancy.
#
# One OSP module instance can only map one type of RADIUS records to
# OSP.  For example, an OSP module instance can map Acme Packet
# RADIUS records to OSP or map GENBAND S3 RADIUS records to OSP, but 
# not both at the same time.
#
# If different types of RADIUS records need to be collected, then a
# different OSP module instance will need to be deployed for each
# type of RADIUS record that will be collected.
#
# In addition to this configuration file the clients.conf file must
# also be edited.  The IP addresses of the client machines that are
# the source of the RADIUS records and the RADIUS secret must be
# configured in the client.conf file.
#

#
# OSP Module Configuration
#
osp {
    #
    # OSP module running parameters
    #

    # This is the default running configuration section. Please do
    # not touch it!!!
    default_running {
        loglevel = 1            # 0 - short, 1 - long */
    }

    # This is the used running configuration section.
    running used {
    }

    #
    # OSP provider parameters
    #

    # This is the default provider configuration section. Please do
    # not touch it!!!
    default_provider {
        accelerate = no         # Only for the first instance
        security = no
        spuri1 = http://osptestserver.transnexus.com:5045/osp
        # spuri1 = https://[1.2.3.4]:1443/osp
        spweight1 = 1000
        spweight2 = 1000
        spweight3 = 1000
        spweight4 = 1000
        privatekey = /usr/local/etc/raddb/pkey.pem
        localcert = /usr/local/etc/raddb/localcert.pem
        cacert0 = /usr/local/etc/raddb/cacert_0.pem
        # cacert1 = /usr/etc/raddb/cacert_1.pem
        ssllifetime = 300       # in seconds
        maxconnections = 20     # 1 ~ 1000
        persistence = 60        # in seconds
        retrydelay = 0          # 0 ~ 10, in seconds
        retrylimit = 2          # 0 ~ 100
        timeout = 10000         # 200 ~ 60000, in milliseconds
        deviceip = localhost
        deviceport = 5060
    }

    # This is the used provider configuration section.
    provider used {
        # The OSP servers IP address parameter MUST be configured.
        # The FreeRADIUS OSP module can be configured to report OSP
        # call detail records to up to 4 OSP servers using the spuri1
        # to spuri4 parameters. Each spuriX is the configuration for
        # an OSP server.  A configuration for spuri1 is required.
        # Configuring other OSP servers, using spuri2, ..., spuri4
        # parameters, is optional. The OSP server address should be
        # configured as a standard URL beginning with either http://
        # or https:// followed by the domain name of the OSP server or
        # the IP address. The domain name or IP address should be
        # followed by the peering server TCP port number and uniform
        # resource identifier /osp.
        spuri1 = http://127.0.0.1:5045/osp

        # The deviceip parameter should be configured with the IP
        # address of the server hosting FreeRADIUS.
        deviceip = 127.0.0.1
    }

    #
    # RADIUS OSP mapping parameters
    #

    # This is the default mapping configuration section. Please do
    # not touch it!!!
    default_mapping {
        reportstart = yes
        reportstop = yes
        reportinterim = yes
        ignoreddestinationlist = NULL
        clienttype = 0                          # 0 - undefined, 1 - Acme, 2 - GENBAND S3, 3 - Cisco */
        callorigin = NULL                       # Only for GENBAND S3 and Cisco
        ignoreanswer = no                       # Only for GENBAND S3 and Cisco
        ignoreoriginate = no                    # Only for GENBAND S3 and Cisco
        transactionid = NULL
        callid = %{Acct-Session-Id}
        callingnumberformat = 0                 # 0 - E.164, 1 - URI, 2 - Cisco */
        callingnumber = %{Calling-Station-Id}   # From header
        callednumberformat = 0                  # 0 - E.164, 1 - URI, 2 - Cisco */
        callednumber = %{Called-Station-Id}     # To header
        assertedid = NULL
        remotepartyid = NULL
        source = %{NAS-IP-Address}
        proxy = NULL                            # Only for GENBAND S3 and Cisco
        sourcedevice = NULL
        destination = NULL
        destinationdevice = NULL
        destinationcount = NULL
        sourcenetworkid = NULL
        destinationnetworkid = NULL
        diversionuser = NULL
        diversionhost = NULL
        timestringformat = 0                    # 0 - time_t, 1 - ctime, 2 - NTP w/o week day, 3 - NTP, 4 - Cisco */
        starttime = %{Acct-Session-Start-Time}
        alerttime = NULL
        connecttime = NULL
        endtime = NULL
        duration = %{Acct-Session-Time}
        postdialdelayunit = 1                   # 0 - seconds, 1 - milliseconds */
        postdialdelay = NULL
        releasesource = NULL
        releasecause = %{Acct-Terminate-Cause}
        signalingprotocol = NULL
        sourceprotocol = NULL
        destinationprotocol = NULL
        sourcesessionid = NULL
        destinationsessionid = NULL
        correlationsessionid = NULL
        sourcecodec = NULL
        destinationcodec = NULL
        conferenceid = NULL
        custominfo1 = NULL
        custominfo2 = NULL
        custominfo3 = NULL
        custominfo4 = NULL
        custominfo5 = NULL
        custominfo6 = NULL
        custominfo7 = NULL
        custominfo8 = NULL
        sourcerealm = NULL
        destinationrealm = NULL
        reportstatistics = yes
        sendlostpackets = NULL
        sendlostfraction = NULL
        receivelostpackets = NULL
        receivelostfraction = NULL
        rtpsourcetoreporteroctets = NULL
        rtpdestinationtoreporteroctets = NULL
        rtpsourcetoreporterpackets = NULL
        rtpdestinationtoreporterpackets = NULL
        rtpsourcetoreporterlost = NULL
        rtpdestinationtoreporterlost = NULL
        rtpsourcetoreporterjittermean = NULL
        rtpdestinationtoreporterjittermean = NULL
        rtpsourcetoreporterjittermax = NULL
        rtpdestinationtoreporterjittermax = NULL
        rtcpsourcetodestinationlost = NULL
        rtcpdestinationtosourcelost = NULL
        rtcpsourcetodestinationjittermean = NULL
        rtcpdestinationtosourcejittermean = NULL
        rtcpsourcetodestinationjittermax = NULL
        rtcpdestinationtosourcejittermax = NULL
        rtcpsourceroundtripdelaymean = NULL
        rtcpdestinationroundtripdelaymean = NULL
        rtcpsourceroundtripdelaymax = NULL
        rtcpdestinationroundtripdelaymax = NULL
        rfactorscaleindex = 4                   # 0 - 0.0001, 1 - 0.001, 2 - 0.01, 3 - 0.1, 4 - 1, 5 - 10, 6 - 100, 7 - 1000, 8 - 10000 */
        sourcetoreporterrfactor = NULL
        destinationtoreporterrfactor = NULL
        mosscaleindex = 4                       # 0 - 0.0001, 1 - 0.001, 2 - 0.01, 3 - 0.1, 4 - 1, 5 - 10, 6 - 100, 7 - 1000, 8 - 10000 */
        sourcetoreportermos = NULL
        destinationtoreportermos = NULL
    }

    #
    # Acme Packet RADIUS mapping to OSP
    #
    # The following section defines mapping of Acme RADIUS accounting
    # records to OSP UsageIndication elements.  If RADIUS records are
    # being collected from an Acme device, the word 'mapping' must be
    # configured before Acme in the first line of this section.
    #
    # For example, the following lines are configured to map Acme
    # records.
    #     mapping Acme {
    #         ...
    #     }
    #
    # The following lines are configured the OSP module to NOT map
    # from Acme RADIUS records.
    #     Acme {
    #         ...
    #     }
    #
    mapping Acme {
        clienttype = 1
        callingnumberformat = 1
        callednumberformat = 1
        callednumber = %{Acme-Primary-Routing-Number}   # Original called number
        sourcedevice = %{Acme-Ingress-Remote-Addr}
        destination = %{Acme-Egress-Remote-Addr}
        diversionuser = %{Acme-SIP-Diversion}
        diversionhost = %{Acme-SIP-Diversion}
        timestringformat = 2
        starttime = %{h323-setup-time}
        connecttime = %{h323-connect-time}
        endtime = %{h323-disconnect-time}
        postdialdelay = %{Acme-Post-Dial-Delay}
        releasesource = %{Acme-Disconnect-Initiator}
        releasecause = %{Acme-Disconnect-Cause}         # ISDN
        signalingprotocol = %{Acme-Session-Protocol-Type}
        sourcesessionid = %{Acme-Session-Ingress-CallId}
        destinationsessionid = %{Acme-Session-Egress-CallId}
        correlationsessionid = %{Acme-Generic-CallId}
        sourcecodec = %{Acme-FlowType_FS1_F}
        destinationcodec = %{Acme-FlowType_FS1_R}
        custominfo1 = %{Acme-Custom-VSA-200}
        rtpsourcetoreporteroctets =  %{Acme-Calling-Octets_FS1}
        rtpdestinationtoreporteroctets = %{Acme-Called-Octets_FS1}
        rtpsourcetoreporterpackets = %{Acme-Calling-Packets_FS1}
        rtpdestinationtoreporterpackets = %{Acme-Called-Packets_FS1}
        rtpsourcetoreporterlost = %{Acme-Calling-RTP-Packets-Lost_FS1}
        rtpdestinationtoreporterlost = %{Acme-Called-RTP-Packets-Lost_FS1}
        rtpsourcetoreporterjittermean = %{Acme-Calling-RTP-Avg-Jitter_FS1}
        rtpdestinationtoreporterjittermean = %{Acme-Called-RTP-Avg-Jitter_FS1}
        rtpsourcetoreporterjittermax = %{Acme-Calling-RTP-MaxJitter_FS1}
        rtpdestinationtoreporterjittermax = %{Acme-Called-RTP-MaxJitter_FS1}
        rtcpsourcetodestinationlost = %{Acme-Called-RTCP-Packets-Lost_FS1}
        rtcpdestinationtosourcelost = %{Acme-Calling-RTCP-Packets-Lost_FS1}
        rtcpsourcetodestinationjittermean = %{Acme-Called-RTCP-Avg-Jitter_FS1}
        rtcpdestinationtosourcejittermean = %{Acme-Calling-RTCP-Avg-Jitter_FS1}
        rtcpsourcetodestinationjittermax = %{Acme-Called-RTCP-MaxJitter_FS1}
        rtcpdestinationtosourcejittermax = %{Acme-Calling-RTCP-MaxJitter_FS1}
        rtcpsourceroundtripdelaymean = %{Acme-Calling-RTCP-Avg-Latency_FS1}
        rtcpdestinationroundtripdelaymean = %{Acme-Called-RTCP-Avg-Latency_FS1}
        rtcpsourceroundtripdelaymax = %{Acme-Calling-RTCP-MaxLatency_FS1}
        rtcpdestinationroundtripdelaymax = %{Acme-Called-RTCP-MaxLatency_FS1}
        rfactorscaleindex = 2
        sourcetoreporterrfactor = %{Acme-Calling-R-Factor}
        destinationtoreporterrfactor = %{Acme-Called-R-Factor}
        mosscaleindex = 2
        sourcetoreportermos = %{Acme-Calling-MOS}
        destinationtoreportermos = %{Acme-Called-MOS} 
    }

    #
    # GENBAND S3 RADIUS mapping to OSP
    #
    # The following section defines mapping of GENBAND S3 RADIUS
    # accounting records to OSP UsageIndication elements.  If RADIUS
    # records are being collected from a GENBAND S3 device, the word
    # 'mapping' must be configured before GENBANDS3 in the first line
    # of this section.
    #
    # For example, the following lines are configured to map GENBAND
    # S3 records.
    #     mapping GENBANDS3 {
    #         ...
    #     }
    #
    # The following lines are configured the OSP module to NOT map
    # from GENBAND S3 RADIUS records.
    #     GENBANDS3 {
    #         ...
    #     }
    #
    GENBANDS3 {
        clienttype = 2
        callorigin = %{h323-call-origin}
        callid = %{h323-incoming-conf-id}
        callednumber = %{gw-rxd-cdn}            # Original called number
        sourcedevice = %{h323-remote-address}
        proxy = %{NAS-IP-Address}
        destination = %{h323-remote-address}
        timestringformat = 3
        starttime = %{h323-setup-time}
        connecttime = %{h323-connect-time}
        endtime = %{h323-disconnect-time}
        releasesource = %{release-source}
        releasecause = %{h323-disconnect-cause}
        signalingprotocol = %{session-protocol}
        sourcesessionid = %{h323-incoming-conf-id}
        sourcesessionid = %{h323-conf-id}
        reportstatistics = no
    }

    #
    # Cisco RADIUS mapping to OSP
    #
    # The following section defines mapping of Cisco RADIUS accounting
    # records to OSP UsageIndication elements.  If RADIUS records are
    # being collected from a Cisco device, the word 'mapping' must
    # be configured before Cisco in the first line of this section.
    #
    # For example, the following lines are configured to map Cisco
    # records.
    #     mapping Cisco {
    #         ...
    #     }
    #
    # The following lines are configured the OSP module to NOT map
    # from Cisco RADIUS records.
    #     Cisco {
    #         ...
    #     }
    #
    Cisco {
        clienttype = 3
        callorigin = %{h323-call-origin}
        callid = %{call-id}
        callingnumberformat = 2
        callingnumber = %{gw-rxd-cgn}
        callednumberformat = 2
        callednumber = %{gw-rxd-cdn}
        sourcedevice = %{h323-remote-address}
        proxy = %{NAS-IP-Address}
        destination = %{h323-remote-address}
        timestringformat = 4
        starttime = %{h323-setup-time}
        connecttime = %{h323-connect-time}
        endtime = %{h323-disconnect-time}
        releasecause = %{h323-disconnect-cause}
        signalingprotocol = %{session-protocol}
        sourcesessionid = %{call-id}
        destiantionsessionid = %{call-id}
    }
}

